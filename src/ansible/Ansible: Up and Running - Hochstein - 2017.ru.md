# Annotation Summary of "Запускаем Ansible - Хоштейн Л., Мозер Р. - 2018" book


## Глава 1. Введение

> Разработка системы Ansible началась в феврале 2012-го.

> Ansible, Inc. - компания, стоящая за проектом Ansible, - была приобретена компанией Red Hat.

> Мы внесли множество изменений в это издание, отказaлись от использования контрольных сумм MD5 в OpenSSH и перешли на хэши SHA256.
Все примеры кода в этой книге были протестированы в версии Ansible 2.3.0.

> Откуда взялось название «Ansible»? Название заимствовано из области научной фантастики. Ansible - это устройство связи, способное передавать информацию быстрее скорости света. Писатель Урсула Ле Гуин впервые представила эту идею в своем романе «Планета Роканнона», а остальные писатели-фантасты подхватили ее. Если быть более точным, Майкл ДеХаан позаимствовал название Ansible из книги Орсона Скотта Карда «Игра Эндера». В этой книге Ansible использовался для одновременного контроля большого числа кораблей, удаленных на огромные расстояния.

> Подобно другим средствам управления, Ansible предоставляет предметно-ориентированный язык (Domain Specific Language, DSL), который используется для описания состояний серверов.

> Как мы увидим позже, модули Ansible несут декларативную функцию и используются для описания требуемого состояния серверов.

> Модули также являются идемпотентнымu.

> То есть сценарии Ansible можно запускать на сервере много раз. Это большое усовершенствование, по сравнению с подходом на основе сценариев командной оболочки.

> Идемпотентность - свойство объекта или операции при повторном применении операции к объекту давать тот же результат, что и при одинарном.

> Идея конвергенции (или сходимости) нередко ассоциируется с именем Марка Бургесса (Mark Burgess) и его системой управления конфигурациями CFEngine.

> Если система управления конфигурациями конвергентна, она может многократно выполнять управляющие воздействия, с каждым разом приводя сервер все ближе к желаемому состоянию. Идея конвергенции неприменима к Ansible из-за отсутствия понятия многоэтапных воздействий на конфигурацию серверов. Модули Ansible устроeны так, что единственный запуск сценария Ansible сразу приводит каждый сервер в желаемое состояние.

> Очень тонкий слой абстракции. Поскольку область применения модуля ограничена и зависит от определенной операционной системы, это позволяет писать качественные и надежно работающие модули. Сценарии Ansible не предназначены для использования в разных контекстах.

> Майкл ДеХаан, создатель программного обеспечения Ansible, является бывшим техническим директором компании Ansible. В октябре 2015-го Red Hat купила Ansible Inc.

> Ansible имеет превосходную поддержку шаблонов и переменных с разными областями видимости.

> Ansible применяет SSН-мультиплексирование для оптимизации производительности. Некоторые специалисты используют Ansible для управления тысячами узлов.

> Ansible использует формат файлов YАМL и язык шаблонов Jinja2.

> При желании Ansible можно установить в локальное виртуальное окружение Python (`virtualenv`). Если вы незнакомы с виртуальными окружениями, можете использовать более новый инструмент под названием `pipsi`.

> Vagrant - отличный инструмент управления виртуальными машинами.

> В Vagrant имеется встроенная возможность подготовки виртуальных машин с Ansible.

> Виртуальная машина в терминологии Vagrant называется `machine`, а ее образ - `bох`.

> Каждому серверу должно быть присвоено имя для идентификации в Ansible.

> playbooks/hosts:
> ```shell
> testserver Ansible_host=127.0.0.1 Ansible_port=2222 \ 
>   Ansible_user=vagrant \ 
>   Ansible_private_key_file=.vagrant/мachines/default/virtualbox/private_key
> ```

> Один из недостатков использования Vagrant: мы вынуждены явно передать дополнительные аргументы, чтобы сообщить Ansible параметры подключения.

> Ansible поддерживает программу `ssh-agent`, поэтому нет необходимости явно указывать файлы SSН-ключей в реестре.

> Ansible будет искать файл `ansible.cfg` в следующих местоположениях в указанном порядке: 
> 1. Файл, указанный в переменной окружения `ANSIBLE_CONFIG`. 
> 2. `./ansible.cfg` (`ansible.cfg` в текущем каталоге).
> 3. `~/Ansible.cfg` (`.Ansible.cfg` в вашем домашнем каталоге). 
> 4. `/etc/Ansible/Ansible.cfg`.

> `inventory` - файл реестра

> При работе с Vagrant удобео отключать проверкy SSН-ключей хоста.
>  ansible.cfg: 
> ```ini
> [defaults]
> inventoгy = hosts 
> геmоtе_usег = vagrant 
> private_key_file = .vagrant/мachines/default/virtualbox/prtvate_key 
> host_key_checktng = False
> ```

> С настройками по умолчанию отпадает необходимость указывать имя пользователя или файл с ключами SSH в файле `hosts`. Мы также можем запустить Ansible без аргумента `-i hostname`:
> ```shell
> $ ansible testserver -m ping
> ```

> Произвольные команды также можно выполнять с помощью модуля `command`. При запуске модуля необходимо указать аргумент `-а` с запускаемой командой:
> ```shell
> $ ansible testserver -m соmmаnd -а uptime
> ```

> Модуль `соmmаnd` настолько часто используется, что сделан модулем по умолчанию, то есть его имя можно опустить в команде:
> ```shell
> $ ansible testserver -а uptime
> ```

> Если команда в аргументе `-а` содержит пробелы, ее необходимо заключить в кавычки, чтобы командная оболочка передала всю строку как единый аргумент.

> Чтобы выполнить команду с привилегиями `root`, нужно передать параметр `-b`.
